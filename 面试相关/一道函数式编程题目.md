```js
class PersonReal {
  constructor(name) {
    this.name = name
    this.taskQueue = []
    this.taskIsRunning = false

    function task(name) {
      console.log(`Hi! This is ${name}!`)
    }
    this.taskQueue.push(task.bind(this, name))
    this._runQueue()
  }

  eat(food) {
    const task = food => {
      console.log('Eat ' + food + '~')
    }
    this.taskQueue.push(task.bind(this, food))
    this._runQueue()
    return this
  }

  sleep(time) {
    const task = new Promise((resolve, reject) => {
      setTimeout(() => {
        console.log(`Wake up after ${time}`)
        resolve()
      }, time * 1000)
    })
    this.taskQueue.push(task)
    this._runQueue()
    return this
  }

  sleepFirst(time) {
    const task = new Promise((resolve, reject) => {
      setTimeout(() => {
        console.log(`Wake up after ${time}`)
        resolve()
      }, time * 1000)
    })
    this.taskQueue.unshift(task)
    this._runQueue()
    return this
  }

  _runQueue() {
    if (this.taskIsRunning) return
    this.taskIsRunning = true

    const goNext = () => {
      if (this.taskQueue.length) {
        let task = this.taskQueue.shift()
        console.log(task.then, task);
        if (task.then) {
          task.then(() => {
            goNext()
          })
        } else {
          task()
          goNext()
        }
      } else {
        this.taskIsRunning = false
      }
    }
    Promise.resolve().then(() => {
      goNext()
    })
  }
}

function Person(name) {
  return new PersonReal(name)
}

// Person("Li");
// 输出： Hi! This is Li!

// Person("Dan").sleep(10).eat("dinner");
// 输出：
// Hi! This is Dan!
// 等待10秒..
// Wake up after 10
// Eat dinner~

// Person("Jerry").eat("dinner").eat("supper");
// 输出：
// Hi This is Jerry!
// Eat dinner~
// Eat supper~

Person("Smith").sleepFirst(5).eat("supper");
// 输出：
// 等待5秒
// Wake up after 5
// Hi This is Smith!
// Eat supper
```